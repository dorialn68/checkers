<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Checkers Pro - Advanced AI-Powered Game</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="analytics-modal-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div id="loading-screen" class="loading-screen">
        <div class="loader"></div>
        <p>Loading 3D Checkers...</p>
    </div>

    <div class="game-container">
        <header class="game-header">
            <h1 class="game-title">3D Checkers Pro</h1>
            <div class="game-stats">
                <div class="stat-item">
                    <span class="stat-label">Turn:</span>
                    <span id="current-turn" class="stat-value">Red</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Mode:</span>
                    <span id="game-mode" class="stat-value">PvP</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Captured:</span>
                    <span class="stat-value">
                        Red: <span id="red-score">0</span> | Black: <span id="black-score">0</span>
                    </span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="sidebar sidebar-left">
                <div class="panel">
                    <h3>Game Mode</h3>
                    <div class="mode-buttons">
                        <button class="mode-btn active" data-mode="pvc">
                            <span class="mode-icon">🤖</span>
                            Person vs Computer
                        </button>
                        <button class="mode-btn" data-mode="pvp">
                            <span class="mode-icon">👥</span>
                            Person vs Person
                        </button>
                        <button class="mode-btn" data-mode="helper">
                            <span class="mode-icon">💡</span>
                            Agent Helper Mode
                        </button>
                    </div>
                </div>

                <div class="panel">
                    <h3>AI Difficulty</h3>
                    <div class="difficulty-selector">
                        <button class="diff-btn" data-level="easy">Easy</button>
                        <button class="diff-btn active" data-level="medium">Medium</button>
                        <button class="diff-btn" data-level="hard">Hard</button>
                        <button class="diff-btn" data-level="expert">Expert</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Player Settings</h3>
                    <div class="color-selector">
                        <label>Play As:</label>
                        <select id="player-side" class="color-select">
                            <option value="red" selected>Red</option>
                            <option value="black">Black</option>
                        </select>
                        <label style="margin-top: 10px;">First Move:</label>
                        <select id="first-move" class="color-select">
                            <option value="red" selected>Red Goes First</option>
                            <option value="black">Black Goes First</option>
                        </select>
                        <label style="margin-top: 10px;">Piece Color:</label>
                        <select id="piece-color" class="color-select">
                            <option value="default" selected>Default Colors</option>
                            <option value="custom">Custom Colors</option>
                        </select>
                        <div id="custom-colors" style="display: none; margin-top: 10px;">
                            <label>Red Pieces:</label>
                            <input type="color" id="red-piece-color" value="#cc0000">
                            <label style="margin-top: 5px;">Black Pieces:</label>
                            <input type="color" id="black-piece-color" value="#1a1a1a">
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h3>Camera Controls</h3>
                    <div class="camera-controls">
                        <button id="cam-top" class="cam-btn">Top View</button>
                        <button id="cam-side" class="cam-btn">Side View</button>
                        <button id="cam-perspective" class="cam-btn">3D View</button>
                        <button id="cam-rotate" class="cam-btn">Auto Rotate</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Visual Settings</h3>
                    <div class="lighting-controls">
                        <label>Piece Shininess:</label>
                        <input type="range" id="shininess-slider" min="0" max="100" value="30" class="slider">
                        <span id="shininess-value">30%</span>
                        
                        <label style="margin-top: 10px;">Color Saturation:</label>
                        <input type="range" id="saturation-slider" min="50" max="150" value="100" class="slider">
                        <span id="saturation-value">100%</span>
                        
                        <label style="margin-top: 10px;">Light Brightness:</label>
                        <input type="range" id="brightness-slider" min="30" max="150" value="100" class="slider">
                        <span id="brightness-value">100%</span>
                        
                        <label style="margin-top: 10px;">Board Reflection:</label>
                        <input type="range" id="board-reflection-slider" min="0" max="100" value="20" class="slider">
                        <span id="board-reflection-value">20%</span>
                    </div>
                </div>

                <div class="panel">
                    <h3>Game Rules</h3>
                    <div class="rule-options">
                        <label class="rule-toggle">
                            <input type="checkbox" id="backward-capture" checked>
                            <span>Backward Capture</span>
                            <small>Regular pieces can capture backwards</small>
                        </label>
                        <label class="rule-toggle">
                            <input type="checkbox" id="flying-kings" checked>
                            <span>Flying Kings</span>
                            <small>Kings move like chess bishops</small>
                        </label>
                        <label class="rule-toggle">
                            <input type="checkbox" id="mandatory-capture" checked>
                            <span>Mandatory Capture</span>
                            <small>Must capture when possible</small>
                        </label>
                    </div>
                </div>

                <div class="panel">
                    <h3>Game Controls</h3>
                    <div class="game-controls">
                        <button id="new-game" class="control-btn">New Game</button>
                        <button id="undo-move" class="control-btn">Undo Move</button>
                        <button id="show-hint" class="control-btn hint-btn">Show Hint</button>
                        <button id="show-rules" class="control-btn">Rules</button>
                        <button id="view-analytics" class="control-btn">📊 Analytics</button>
                        <button id="enter-playback" class="control-btn">🎮 Playback</button>
                        <button id="online-play" class="control-btn online-btn">Play Online</button>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>Undo Settings</h3>
                    <div style="padding: 10px;">
                        <label style="display: block; margin-bottom: 10px;">
                            <span>Max Undo Steps:</span>
                            <select id="undo-limit" style="margin-left: 10px; padding: 5px;">
                                <option value="1">1 move</option>
                                <option value="2">2 moves</option>
                                <option value="5" selected>5 moves</option>
                                <option value="10">10 moves</option>
                                <option value="-1">Unlimited</option>
                            </select>
                        </label>
                        <label style="display: block; margin-bottom: 10px;">
                            <input type="checkbox" id="undo-both-players" checked>
                            <span>Undo both players (full turn)</span>
                        </label>
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            History: <span id="move-count">0</span> moves
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>Recording & Sharing</h3>
                    <div class="recording-controls">
                        <label style="display: block; margin-bottom: 10px;">
                            <span>Recording Area:</span>
                            <select id="recording-area" style="margin-left: 10px; padding: 5px;">
                                <option value="full" selected>Full Game (with UI)</option>
                                <option value="canvas">Board Only</option>
                            </select>
                        </label>
                        <button id="record-video" class="control-btn record-btn">🎥 Record Video</button>
                        <button id="record-gif" class="control-btn record-btn">🎬 Record GIF</button>
                        <button id="stop-recording" class="control-btn stop-btn" style="display: none;">⏹️ Stop Recording</button>
                        <div style="margin-top: 10px; font-size: 11px; color: #666;">
                            <p>• <strong>Full Game:</strong> Captures everything including menus</p>
                            <p>• <strong>Board Only:</strong> Just the 3D game board</p>
                            <p>• Video: WebM format, up to 60s</p>
                            <p>• GIF: 10 fps, up to 30s</p>
                            <p>• Perfect for LinkedIn demos!</p>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>Debug Tools</h3>
                    <div class="debug-controls">
                        <button id="capture-screenshot" class="control-btn">📷 Capture Bug</button>
                        <button id="copy-board-state" class="control-btn">📋 Copy Board</button>
                        <div id="debug-info" style="display: none; margin-top: 10px; font-size: 12px; color: #4CAF50;"></div>
                    </div>
                </div>
            </div>

            <div class="game-board-container">
                <canvas id="game-canvas"></canvas>
                <div class="move-indicator" id="move-indicator"></div>
                
                <!-- Playback Controls -->
                <div id="playback-controls-container" style="display: none; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.95); border-radius: 10px;">
                    <div style="text-align: center; margin-bottom: 10px;">
                        <strong id="playback-move-counter">Move 0 / 0</strong>
                        <span id="playback-move-info" style="margin-left: 20px; color: #666;"></span>
                    </div>
                    
                    <div id="playback-timeline" class="timeline" style="height: 40px; background: #e0e0e0; border-radius: 20px; margin: 10px 0; cursor: pointer; position: relative;">
                        <div class="timeline-progress" style="height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 20px; width: 0%; transition: width 0.3s;"></div>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
                        <button class="control-btn" onclick="playbackController.goToStart()">⏮</button>
                        <button class="control-btn" onclick="playbackController.previousMove()">⏪</button>
                        <button class="control-btn" id="playback-play-btn" onclick="playbackController.togglePlayback()">▶</button>
                        <button class="control-btn" onclick="playbackController.nextMove()">⏩</button>
                        <button class="control-btn" onclick="playbackController.goToEnd()">⏭</button>
                        <button class="control-btn" onclick="playbackController.exitPlaybackMode()" style="background: #dc3545;">✖ Exit</button>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
                        <label>Speed:</label>
                        <button class="control-btn" onclick="playbackController.setSpeed(0.5)" style="padding: 5px 10px;">0.5x</button>
                        <button class="control-btn" onclick="playbackController.setSpeed(1)" style="padding: 5px 10px;">1x</button>
                        <button class="control-btn" onclick="playbackController.setSpeed(2)" style="padding: 5px 10px;">2x</button>
                        <button class="control-btn" onclick="playbackController.setSpeed(4)" style="padding: 5px 10px;">4x</button>
                    </div>
                </div>
                
                <div class="board-legend">
                    <div class="legend-text">Board Coordinates: A-H (columns) × 1-8 (rows)</div>
                    <div class="legend-text">Each black square shows its coordinate (e.g., A1, B2, C3)</div>
                </div>
            </div>

            <div class="sidebar sidebar-right">
                <div class="panel chat-panel">
                    <h3>AI Assistant</h3>
                    <div class="ai-settings">
                        <select id="llm-provider" class="llm-select">
                            <option value="local">Built-in AI (No API needed)</option>
                            <option value="openai">OpenAI GPT-3.5</option>
                            <option value="anthropic">Claude Haiku</option>
                            <option value="groq">Groq (Fast & Free)</option>
                        </select>
                        <input type="password" id="api-key" class="api-key-input" placeholder="API Key (if needed)" style="display: none;">
                        <div class="token-info">
                            <span>Est. cost: $<span id="token-cost">0.00</span></span>
                        </div>
                        <div style="margin-top: 10px; padding: 8px; background: #fff3cd; border-radius: 5px; font-size: 11px; color: #856404; display: none;" id="api-key-warning">
                            ⚠️ <strong>Security Notice:</strong> API keys are stored only in your browser's local storage and are never sent to any server except the AI provider's API. When playing on GitHub Pages, ensure you're using HTTPS. For maximum security, use environment variables or the built-in AI option.
                        </div>
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <div class="chat-message ai-message">
                            <strong>AI Assistant:</strong> Welcome! I'm using the built-in AI engine (no API key needed). I can analyze positions, suggest moves, and explain strategies. Click "Analyze Board" or ask me anything!
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" class="chat-input" placeholder="Ask for move suggestions...">
                        <button id="chat-send" class="chat-send">Send</button>
                        <button id="analyze-board" class="analyze-btn">Analyze Board</button>
                    </div>
                </div>

                <div class="panel move-history-panel">
                    <h3>Move History</h3>
                    <div class="move-history" id="move-history">
                        <div class="history-empty">No moves yet</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Checkers Rules</h2>
            <div class="rules-content">
                <h3>Enhanced Rules (NEW!):</h3>
                <ul>
                    <li><strong>Movement:</strong> Regular pieces move diagonally forward one square</li>
                    <li><strong>Backward Capture:</strong> 🆕 Regular pieces can now capture backwards!</li>
                    <li><strong>Flying Kings:</strong> 🆕 Kings can move multiple squares diagonally and jump from distance!</li>
                    <li><strong>Capturing:</strong> Jump over opponent's pieces (mandatory when possible)</li>
                    <li><strong>Multiple Jumps:</strong> Must continue jumping if possible after a capture</li>
                    <li><strong>Winning:</strong> Capture all opponent pieces or block all their moves</li>
                </ul>
                
                <h3>Controls:</h3>
                <ul>
                    <li>Click a piece to select it</li>
                    <li>Click a highlighted square to move</li>
                    <li>Use mouse to rotate the 3D board</li>
                    <li>Scroll to zoom in/out</li>
                </ul>

                <h3>Special Features:</h3>
                <ul>
                    <li><strong>AI Helper:</strong> Get move suggestions from the AI assistant</li>
                    <li><strong>Agent Mode:</strong> AI highlights best moves in real-time</li>
                    <li><strong>3D View:</strong> Rotate camera for different perspectives</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="game-logic.js"></script>
    <script src="ai-opponent.js"></script>
    <script src="3d-renderer.js"></script>
    <script src="llm-integration.js"></script>
    <script src="move-validator.js"></script>
    <script src="game-analytics.js"></script>
    <script src="playback-controller.js"></script>
    <script src="bug-capture.js"></script>
    <script src="game-recorder.js"></script>
    <script src="confetti.js"></script>
    <script src="analytics-renderer-full.js"></script>
    <script src="analytics-modal-wrapper.js"></script>
    <script src="mobile-support.js"></script>
    <script src="main.js"></script>
</body>
</html>